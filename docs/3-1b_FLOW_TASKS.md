# Flow Control Tasks

Top-level tasks are always executed in sequence (as in conventional programming languages). However, the set of tasks
contained in the `Flow` subgroup can be used to modify the execution flow of child tasks:

## Flow.Sequence

Executes all child steps in the same order as defined in the `Children` list. Useful for grouping related tasks or for
defining separate branches for `Parallel` or `Select`. Does not use any additional parameters.

## Flow.Parallel

Executes each of the child steps concurrently, as separate threads. The exact timing in which each thread starts or
ends is not guaranteed and cannot be considered replicable. The execution of `Parallel` stops when all threads are
completed (all threads are *joined* at the end). Does not use any additional parameters.

> All threads generated by `Parallel` share the same temporary folder (the one created for the experiment).
> Additional safeguards should be considered to avoid multiple threads accessing the same file, where applicable.

## Flow.Repeat

Executes all child steps in the same order as defined in the `Children` list, for a pre-determined number of times.

**Configuration values:**

- `Times`: Number of times to repeat the execution of the children.

## Flow.While

Executes all child steps in the same order as defined in the `Children` list, while the specified condition evaluates to `True`.

**Configuration values:**

- See the [Defining Conditions](#defining-conditions) section.
- `MaxIterations`: Maximum number of iterations that can be run. Unlimited by default. If defined, the loop will
  exit after the value is reached, regardless of the evaluation of the condition.

## Flow.Select

Executes the first child in the `Children` list whose condition evaluates to `True`, or the last child (if present, when
there is a single missing condition in the configuration) if all other conditions evaluate to `False`.

**Configuration values:**

- `Conditions`: List of conditions, where each entry is a dictionary as described in the
  [Defining Conditions](#defining-conditions) section. The task requires either one condition per child task, or exactly
  one less, to implement a *default* or *else* branch.

# Defining Conditions

A Condition is defined as a dictionary with a set of expected fields. There are two kinds of conditions:

- **Evaluate** Conditions: Defined using the `Evaluate` field. This works similarly to the
  [`Run.Evaluate`](/docs/3-2a_GENERAL_TASKS.md#runevaluate) task. However, instead of publishing the result, it
  checks whether the expression evaluates to `True`.

  > If the evaluation raises an exception, the expression is considered `False` (a warning will be added to the log).

- **Key** Conditions: Defined using the `Key` field. These can be used to check whether a specific key has been published
  and whether its value matches a given regular expression.

**Only one of `Evaluate` or `Key` must be specified per condition.** The following fields are optional:

- `Negate`: Boolean indicating whether the condition should be negated. Defaults to `False`.
- `Pattern`: A regular expression for Key Conditions. Defaults to `None`.
  - If present, the value for `Key` is checked against the regex. A match makes the condition evaluate to `True`.
  - If not present, only the existence of `Key` is checked. If it exists, the condition evaluates to `True`.

> âš  Evaluate Conditions make use of the [eval](https://docs.python.org/3/library/functions.html#eval) built-in function:
> - Evaluate Conditions can execute arbitrary code.
> - Since test cases are defined by platform operators, it is expected that no dangerous code will be executed.
>   However, **exercise extreme caution, especially if variable expansion is used** as part of the condition.

# Optional Task Parameters

### ðŸ›‘ `NoStop` Flag

Some tasks support the optional `NoStop: True` configuration flag. When this flag is set, the task **will not be stopped**
even if a global execution cancellation is requested (e.g., by the operator or the system).

```yaml
Config:
  ExecutionId: "@{ExecutionId}"
  Measurement: "MQTT"
  NoStop: True
